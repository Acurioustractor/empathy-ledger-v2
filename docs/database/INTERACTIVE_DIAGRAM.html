<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Empathy Ledger Database Map - Interactive</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            margin: 0; padding: 0; min-height: 100vh; width: 100%; overflow-x: hidden;
        }

        .container {
            max-width: 100%; width: 100%; margin: 0 auto; padding: 10px;
            margin: 0 auto;
        }

        header {
            background: white;
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        h1 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }

        .stat-number {
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 14px;
            opacity: 0.9;
        }

        .systems-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .system-card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: all 0.3s ease;
            border-left: 5px solid;
        }

        .system-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        .system-card.identity { border-left-color: #FF6B6B; }
        .system-card.content { border-left-color: #4ECDC4; }
        .system-card.media { border-left-color: #45B7D1; }
        .system-card.org { border-left-color: #FFA07A; }
        .system-card.project { border-left-color: #98D8C8; }
        .system-card.cultural { border-left-color: #F7DC6F; }
        .system-card.analytics { border-left-color: #BB8FCE; }
        .system-card.access { border-left-color: #85C1E2; }
        .system-card.system { border-left-color: #A8DADC; }

        .system-icon {
            font-size: 36px;
            margin-bottom: 15px;
        }

        .system-title {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 10px;
            color: #2c3e50;
        }

        .system-count {
            color: #7f8c8d;
            margin-bottom: 15px;
            font-size: 14px;
        }

        .table-list {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .system-card.expanded .table-list {
            max-height: 500px;
        }

        .table-item {
            background: #f8f9fa;
            padding: 8px 12px;
            margin: 5px 0;
            border-radius: 5px;
            font-size: 13px;
            font-family: 'Monaco', 'Courier New', monospace;
            color: #495057;
        }

        .expand-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
            transition: background 0.3s ease;
        }

        .expand-btn:hover {
            background: #764ba2;
        }

        .flow-diagram {
            background: white;
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 30px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .flow-title {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 20px;
            color: #2c3e50;
        }

        .flow-steps {
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 15px;
        }

        .flow-step {
            flex: 1;
            min-width: 150px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px 15px;
            border-radius: 8px;
            text-align: center;
            position: relative;
        }

        .flow-arrow {
            font-size: 24px;
            color: #667eea;
        }

        .legend {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .legend-title {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 15px;
            color: #2c3e50;
        }

        .legend-items {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .legend-color {
            width: 30px;
            height: 30px;
            border-radius: 5px;
        }

        .search-box {
            background: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 30px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .search-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e1e8ed;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .search-input:focus {
            outline: none;
            border-color: #667eea;
        }

        .highlight {
            background-color: #ffeaa7;
            padding: 2px 5px;
            border-radius: 3px;
        }

        @media (max-width: 768px) {
            .systems-grid {
                grid-template-columns: 1fr;
            }

            .flow-steps {
                flex-direction: column;
            }

            .flow-arrow {
                transform: rotate(90deg);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üóÑÔ∏è Empathy Ledger Database Architecture</h1>
            <p>Interactive visualization of 47 migrations, 87 tables, 82 functions</p>

            <div class="stats">
                <div class="stat-card">
                    <div class="stat-number">87</div>
                    <div class="stat-label">Tables</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">82</div>
                    <div class="stat-label">Functions</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">210</div>
                    <div class="stat-label">RLS Policies</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">8</div>
                    <div class="stat-label">Views</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">47</div>
                    <div class="stat-label">Migrations</div>
                </div>
            </div>
        </header>

        <div class="search-box">
            <input type="text" class="search-input" id="searchInput" placeholder="üîç Search for tables, systems, or functions...">
        </div>

        <div class="flow-diagram">
            <div class="flow-title">üìä Data Flow: Story Creation</div>
            <div class="flow-steps">
                <div class="flow-step">
                    <div>üë§ User</div>
                    <small>Authenticated</small>
                </div>
                <div class="flow-arrow">‚Üí</div>
                <div class="flow-step">
                    <div>üìù Draft</div>
                    <small>story_drafts</small>
                </div>
                <div class="flow-arrow">‚Üí</div>
                <div class="flow-step">
                    <div>üé¨ Media</div>
                    <small>media_assets</small>
                </div>
                <div class="flow-arrow">‚Üí</div>
                <div class="flow-step">
                    <div>‚úÖ Publish</div>
                    <small>stories</small>
                </div>
                <div class="flow-arrow">‚Üí</div>
                <div class="flow-step">
                    <div>üìà Analytics</div>
                    <small>engagement</small>
                </div>
            </div>
        </div>

        <h2 style="color: white; margin-bottom: 20px; text-align: center;">Database Systems</h2>

        <div class="systems-grid" id="systemsGrid">
            <!-- Systems will be inserted here by JavaScript -->
        </div>

        <div class="legend">
            <div class="legend-title">üé® System Color Legend</div>
            <div class="legend-items">
                <div class="legend-item">
                    <div class="legend-color" style="background: #FF6B6B;"></div>
                    <span>Identity & Profiles</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #4ECDC4;"></div>
                    <span>Content (Stories/Transcripts)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #45B7D1;"></div>
                    <span>Media System</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #FFA07A;"></div>
                    <span>Organizations</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #98D8C8;"></div>
                    <span>Project Management</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #F7DC6F;"></div>
                    <span>Cultural Safety</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #BB8FCE;"></div>
                    <span>Analytics & Metrics</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #85C1E2;"></div>
                    <span>Access Control</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #A8DADC;"></div>
                    <span>System & Events</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        const systems = [
            {
                name: 'User & Profile System',
                icon: 'üë§',
                class: 'identity',
                count: 1,
                tables: ['project_profiles']
            },
            {
                name: 'Content System',
                icon: 'üìù',
                class: 'content',
                count: 3,
                tables: ['public.transcripts', 'storyteller_quotes', 'storyteller_transcripts']
            },
            {
                name: 'Media System',
                icon: 'üé¨',
                class: 'media',
                count: 5,
                tables: ['public.media_assets', 'public.media_import_sessions', 'public.media_usage_tracking', 'story_media_links', 'storyteller_media_library']
            },
            {
                name: 'Organization & Multi-Tenant',
                icon: 'üè¢',
                class: 'org',
                count: 13,
                tables: ['dream_organizations', 'organization_contexts', 'organization_cross_transcript_insights', 'organization_impact_metrics', 'organization_invitations', 'organization_roles', 'organization_storyteller_network', 'organization_theme_analytics', 'partner_team_members', 'profile_organizations', 'public.tenant_members', 'public.tenants', 'tenant_ai_policies']
            },
            {
                name: 'Project Management',
                icon: 'üìÅ',
                class: 'project',
                count: 11,
                tables: ['act_projects', 'organization_contexts', 'partner_projects', 'project_analyses', 'project_contexts', 'project_profiles', 'project_seed_interviews', 'public.ai_analysis_jobs', 'story_project_features', 'story_project_tags', 'storyteller_project_features']
            },
            {
                name: 'Cultural Sensitivity',
                icon: 'üõ°Ô∏è',
                class: 'cultural',
                count: 5,
                tables: ['ai_moderation_logs', 'consent_change_log', 'moderation_appeals', 'moderation_results', 'story_syndication_consent']
            },
            {
                name: 'Analytics & Metrics',
                icon: 'üìä',
                class: 'analytics',
                count: 13,
                tables: ['analytics_processing_jobs', 'geographic_impact_patterns', 'organization_impact_metrics', 'organization_theme_analytics', 'partner_analytics_daily', 'platform_analytics', 'public.media_usage_tracking', 'story_engagement_daily', 'story_engagement_events', 'storyteller_analytics', 'storyteller_engagement', 'storyteller_impact_metrics', 'theme_evolution_tracking']
            },
            {
                name: 'Access Control & Sharing',
                icon: 'üîê',
                class: 'access',
                count: 10,
                tables: ['organization_invitations', 'partner_analytics_daily', 'partner_message_templates', 'partner_messages', 'partner_projects', 'partner_team_members', 'public.embed_tokens', 'story_access_log', 'story_access_tokens', 'story_review_invitations']
            },
            {
                name: 'System & Events',
                icon: '‚öôÔ∏è',
                class: 'system',
                count: 10,
                tables: ['ai_moderation_logs', 'ai_safety_logs', 'ai_usage_events', 'consent_change_log', 'notifications', 'public.activity_log', 'public.audit_logs', 'story_access_log', 'story_engagement_events', 'webhook_delivery_log']
            }
        ];

        function renderSystems() {
            const grid = document.getElementById('systemsGrid');

            systems.forEach(system => {
                const card = document.createElement('div');
                card.className = `system-card ${system.class}`;
                card.innerHTML = `
                    <div class="system-icon">${system.icon}</div>
                    <div class="system-title">${system.name}</div>
                    <div class="system-count">${system.count} table${system.count !== 1 ? 's' : ''}</div>
                    <button class="expand-btn">Show Tables</button>
                    <div class="table-list">
                        ${system.tables.map(table => `<div class="table-item">${table}</div>`).join('')}
                    </div>
                `;

                const btn = card.querySelector('.expand-btn');
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    card.classList.toggle('expanded');
                    btn.textContent = card.classList.contains('expanded') ? 'Hide Tables' : 'Show Tables';
                });

                grid.appendChild(card);
            });
        }

        // Search functionality
        const searchInput = document.getElementById('searchInput');
        searchInput.addEventListener('input', (e) => {
            const query = e.target.value.toLowerCase();
            const cards = document.querySelectorAll('.system-card');

            cards.forEach(card => {
                const systemName = card.querySelector('.system-title').textContent.toLowerCase();
                const tables = Array.from(card.querySelectorAll('.table-item')).map(t => t.textContent.toLowerCase());

                const matchesSystem = systemName.includes(query);
                const matchesTables = tables.some(table => table.includes(query));

                if (matchesSystem || matchesTables) {
                    card.style.display = 'block';
                    if (query.length > 0 && matchesTables) {
                        card.classList.add('expanded');
                        card.querySelector('.expand-btn').textContent = 'Hide Tables';
                    }
                } else {
                    card.style.display = 'none';
                }
            });
        });

        // Initialize
        renderSystems();
    </script>
</body>
</html>

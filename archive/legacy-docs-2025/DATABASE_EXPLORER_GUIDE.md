# Database Explorer Guide

**Complete visual documentation system for all 106+ Supabase tables**

---

## üéØ What You Have

### Visual Tools (Interactive)

**1. Interactive Web Dashboard**
```
URL: /admin/database-explorer
Status: ‚úÖ Ready to use (just created!)
```
- Search all 106+ tables
- Filter by category (12 categories)
- View column details
- Check RLS policies
- See table relationships
- Grid or list view

**2. Network Graph (D3.js)**
```
File: docs/database/NETWORK_GRAPH.html
Status: ‚úÖ Available
```
- Interactive force-directed graph
- Drag nodes to explore
- Click to see relationships
- Filter by system
- Zoom and pan

**3. Interactive Dashboard (HTML)**
```
File: docs/database/INTERACTIVE_DIAGRAM.html
Status: ‚úÖ Available
```
- 9 system categories
- Expandable cards
- Search functionality
- Stats dashboard
- Color-coded systems

### Documentation Files

**4. Schema Summary**
```
File: docs/database/SCHEMA_SUMMARY.md
Status: ‚úÖ Generated (52 migrations analyzed)
```
- 106 tables categorized
- 88 functions documented
- 8 views listed
- 228 RLS policies counted

**5. ER Diagrams (Mermaid)**
```
Files: docs/database/diagrams/*.md
Status: ‚öôÔ∏è  Generate with script
```
- Complete database ERD
- Category-specific diagrams
- Relationship visualization

**6. Complete Schema SQL**
```
Generated by: ./scripts/analyze-database.sh
Contains: Full SQL dump
```

---

## üöÄ How to Use

### Option 1: Web Explorer (Easiest)

```bash
# Start your dev server
npm run dev

# Open in browser
open http://localhost:3000/admin/database-explorer
```

**Features:**
- ‚úÖ Search 106+ tables instantly
- ‚úÖ Filter by 12 categories
- ‚úÖ View stats (total tables, RLS enabled, etc.)
- ‚úÖ Grid or list view
- ‚úÖ Click tables for details

### Option 2: Interactive HTML Files (Offline)

```bash
# Network graph
open docs/database/NETWORK_GRAPH.html

# Dashboard
open docs/database/INTERACTIVE_DIAGRAM.html

# Both work without server!
```

### Option 3: Generated Documentation

```bash
# Run analyzer
./scripts/analyze-database.sh

# View results
cat docs/database/SCHEMA_SUMMARY.md
```

### Option 4: ER Diagrams

```bash
# Generate all diagrams
node scripts/generate-er-diagram.js --all

# View specific category
node scripts/generate-er-diagram.js impact
node scripts/generate-er-diagram.js cultural
node scripts/generate-er-diagram.js ai
```

---

## üìä What Each Tool Shows

### Web Explorer (`/admin/database-explorer`)

**Stats Dashboard:**
- Total Tables: 106
- Categories: 12
- Tables with RLS: ~90+
- Currently Filtered: Updates dynamically

**Search & Filter:**
- Type to search table names
- Select category dropdown
- Switch between grid/list view

**Table Cards Show:**
- Table name
- Column count
- RLS status (shield icon)
- "View Details" button

**Categories:**
1. User & Profile
2. Organizations & Tenants
3. Projects & Stories
4. Media & Assets
5. AI & Analysis
6. Impact Analysis (15 tables)
7. Cultural Safety
8. Community
9. System
10. Partner Portal
11. Themes
12. Other

### Network Graph (HTML)

**Visual:**
- Nodes = Tables
- Edges = Relationships (foreign keys)
- Colors = System category
- Size = Number of connections

**Interactions:**
- Drag nodes to rearrange
- Zoom with mouse wheel
- Click nodes for info
- Filter by system type

### Schema Summary (Markdown)

**Contains:**
- All 106 tables listed
- Organized by 12 systems
- Function count: 88
- View count: 8
- RLS policy count: 228

---

## üîç Common Tasks

### "Show me all Impact Analysis tables"

**Method 1: Web Explorer**
```
1. Open /admin/database-explorer
2. Select "Impact Analysis" from dropdown
3. See all 15 tables
```

**Method 2: Schema Summary**
```bash
cat docs/database/SCHEMA_SUMMARY.md | grep -A 20 "Impact Analysis"
```

**Method 3: Generate ER Diagram**
```bash
node scripts/generate-er-diagram.js impact
# View: docs/database/diagrams/er-diagram-impact.md
```

### "Find all tables with 'storyteller' in name"

**Method 1: Web Explorer**
```
1. Open /admin/database-explorer
2. Type "storyteller" in search
3. See filtered results
```

**Method 2: Bash**
```bash
grep "storyteller" docs/database/SCHEMA_SUMMARY.md
```

**Method 3: SQL Function**
```sql
SELECT * FROM search_schema('storyteller');
```

### "See all relationships for stories table"

**Method 1: Network Graph**
```
1. Open docs/database/NETWORK_GRAPH.html
2. Click "stories" node
3. See connected tables
```

**Method 2: SQL Function**
```sql
SELECT * FROM get_table_relationships()
WHERE from_table = 'stories' OR to_table = 'stories';
```

**Method 3: ER Diagram**
```bash
node scripts/generate-er-diagram.js core
# View generated Mermaid diagram
```

### "Check which tables have RLS enabled"

**Method 1: Web Explorer**
```
1. Open /admin/database-explorer
2. Look for shield icons üõ°Ô∏è
3. Tables with shields have RLS
```

**Method 2: SQL Function**
```sql
SELECT
  table_name,
  has_rls
FROM get_database_schema()
WHERE has_rls = true
ORDER BY table_name;
```

### "Get complete details for one table"

**Method 1: SQL Functions**
```sql
-- Table metadata
SELECT * FROM get_database_schema()
WHERE table_name = 'stories';

-- Columns
SELECT * FROM get_table_columns('stories');

-- RLS policies
SELECT * FROM get_table_policies('stories');

-- Relationships
SELECT * FROM get_table_relationships()
WHERE from_table = 'stories' OR to_table = 'stories';
```

**Method 2: Web Explorer**
```
1. Open /admin/database-explorer
2. Search for "stories"
3. Click "View Details"
```

---

## üõ†Ô∏è Database Functions Available

### get_database_schema()
Returns all tables with metadata:
```sql
SELECT * FROM get_database_schema();

-- Returns:
-- table_name, column_count, has_rls, row_count, table_size
```

### get_table_columns(table_name)
Returns columns for a table:
```sql
SELECT * FROM get_table_columns('stories');

-- Returns:
-- column_name, data_type, is_nullable, column_default,
-- is_primary_key, is_foreign_key, foreign_table, foreign_column
```

### get_table_relationships()
Returns all foreign keys:
```sql
SELECT * FROM get_table_relationships();

-- Returns:
-- from_table, from_column, to_table, to_column, constraint_name
```

### get_table_policies(table_name)
Returns RLS policies:
```sql
SELECT * FROM get_table_policies('stories');

-- Returns:
-- policy_name, policy_command, policy_roles, policy_qual, policy_check
```

### get_database_stats()
Returns overall statistics:
```sql
SELECT * FROM get_database_stats();

-- Returns:
-- total_tables, total_columns, total_indexes,
-- total_functions, total_policies, database_size
```

### search_schema(search_term)
Search tables and columns:
```sql
SELECT * FROM search_schema('organization');

-- Returns:
-- result_type (table/column), table_name, column_name,
-- data_type, description
```

---

## üìã Database Statistics

**Current Counts** (run `SELECT * FROM get_database_stats()` for latest):

- **Tables**: 106
- **Functions**: 88
- **Views**: 8
- **RLS Policies**: 228
- **Migrations**: 52

**Tables by Category:**

| Category | Count |
|----------|-------|
| System Infrastructure | 25+ |
| AI & Analysis | 20 |
| Impact Analysis | 15 |
| Organizations & Tenants | 13 |
| Projects & Stories | 13 |
| Analytics & Metrics | 13 |
| Cultural Safety | 10 |
| User & Profile | 8 |
| Media & Assets | 8 |
| Partner Portal | 8 |
| Themes | 8 |
| Community | 12 |

---

## üé® Visual Examples

### Impact Analysis System

**Tables (15):**
```
story_narrative_arcs          - Emotional journey
theme_evolution               - Theme tracking
theme_concept_evolution       - Semantic shifts
audio_prosodic_analysis       - Voice analysis
audio_emotion_analysis        - Emotion detection
cultural_speech_patterns      - Language patterns
sroi_inputs                   - SROI investment
sroi_outcomes                 - SROI stakeholder outcomes
sroi_calculations             - SROI results
ripple_effects                - Impact spreading
harvested_outcomes            - Emergent changes
community_interpretation_sessions - Group analysis
storytelling_circle_evaluations - Circle protocols
community_story_responses     - Feedback
theory_of_change              - ToC framework
```

**View in Explorer:**
```
/admin/database-explorer?category=Impact+Analysis
```

**ER Diagram:**
```bash
node scripts/generate-er-diagram.js impact
```

**Documentation:**
- [IMPACT_SYSTEM_ARCHITECTURE.md](IMPACT_SYSTEM_ARCHITECTURE.md)
- [IMPACT_USER_JOURNEY.md](IMPACT_USER_JOURNEY.md)
- [IMPACT_SYSTEM_MAP.md](IMPACT_SYSTEM_MAP.md)

---

## üîÑ Regenerate Documentation

### Full Regeneration

```bash
# 1. Run analyzer
./scripts/analyze-database.sh

# 2. Generate ER diagrams
node scripts/generate-er-diagram.js --all

# 3. View results
open docs/database/SCHEMA_SUMMARY.md
open docs/database/diagrams/
```

### Quick Refresh

```bash
# Just schema summary
./scripts/analyze-database.sh

# Just one ER diagram
node scripts/generate-er-diagram.js impact
```

### After Migration

```bash
# Push migration
supabase db push

# Regenerate docs
./scripts/analyze-database.sh

# Commit
git add docs/database/
git commit -m "docs: update database documentation"
```

---

## üéØ Recommended Workflow

### For Exploration

**Step 1: Get the Big Picture**
```bash
open docs/database/NETWORK_GRAPH.html
```
- See all tables and connections
- Understand system relationships

**Step 2: Dive into Categories**
```bash
open http://localhost:3000/admin/database-explorer
```
- Filter by category
- Search for specific tables
- View detailed information

**Step 3: Review Documentation**
```bash
cat docs/database/SCHEMA_SUMMARY.md
```
- Read categorized lists
- See function/view counts
- Understand structure

### For Documentation

**Step 1: Generate Fresh Diagrams**
```bash
./scripts/analyze-database.sh
node scripts/generate-er-diagram.js --all
```

**Step 2: Export What You Need**
- Mermaid diagrams ‚Üí Paste in [mermaid.live](https://mermaid.live) ‚Üí Export PNG/SVG
- HTML visualizations ‚Üí Screenshot or Print to PDF
- SQL schema ‚Üí Use `docs/database/schema.sql`

**Step 3: Share**
- GitHub renders Mermaid automatically
- HTML files work without server
- Markdown docs readable anywhere

---

## üìö Related Documentation

**Impact Analysis:**
- [Impact System Summary](../IMPACT_SYSTEM_SUMMARY.md)
- [Impact System Map](IMPACT_SYSTEM_MAP.md)
- [Impact Architecture](IMPACT_SYSTEM_ARCHITECTURE.md)
- [Impact User Journeys](IMPACT_USER_JOURNEY.md)

**Database General:**
- [Database Alignment Audit](DATABASE_ALIGNMENT_AUDIT.md)
- [Cloud Database Workflow](CLOUD_FIRST_DATABASE_WORKFLOW.md)
- [Architecture Reference](ARCHITECTURE_REFERENCE.md)

**Generated:**
- [Schema Summary](database/SCHEMA_SUMMARY.md)
- [Database Map](database/DATABASE_MAP.md)
- [Quick Reference](database/QUICK_REFERENCE.md)

---

## üÜò Troubleshooting

### Web Explorer Not Loading

```bash
# Check if functions exist
supabase db push

# Restart server
npm run dev

# Open explorer
open http://localhost:3000/admin/database-explorer
```

### HTML Files Won't Open

```bash
# Start simple server
python3 -m http.server 8000

# Open in browser
open http://localhost:8000/docs/database/NETWORK_GRAPH.html
```

### Scripts Not Running

```bash
# Make executable
chmod +x scripts/*.sh
chmod +x scripts/*.js

# Install dependencies
npm install

# Try again
./scripts/analyze-database.sh
```

---

## üéä Summary

**You now have:**

‚úÖ **Interactive Web Explorer** - `/admin/database-explorer`
‚úÖ **Network Graph** - `docs/database/NETWORK_GRAPH.html`
‚úÖ **Interactive Dashboard** - `docs/database/INTERACTIVE_DIAGRAM.html`
‚úÖ **Schema Summary** - `docs/database/SCHEMA_SUMMARY.md`
‚úÖ **ER Diagram Generator** - `scripts/generate-er-diagram.js`
‚úÖ **6 SQL Functions** - Query metadata directly
‚úÖ **Complete Documentation** - All impact analysis docs

**All 106+ tables are:**
- ‚úÖ Searchable
- ‚úÖ Filterable by category
- ‚úÖ Visualized with relationships
- ‚úÖ Documented with properties
- ‚úÖ Queryable with SQL functions

**Start exploring:**
```bash
npm run dev
open http://localhost:3000/admin/database-explorer
```

---

**Version**: 1.0.0
**Last Updated**: December 25, 2025
**Tables**: 106
**Status**: ‚úÖ Complete and ready to use!
